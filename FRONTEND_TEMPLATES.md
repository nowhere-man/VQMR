# 转码模板前端功能文档

**日期**: 2025-10-27
**版本**: v0.2.0
**功能**: 转码模板 Web UI

## 概述

为转码模板功能添加了完整的 Web 界面，用户可以在浏览器中直接创建、查看、编辑、删除和执行转码模板。

## 新增页面

### 1. 模板列表页面 (`/templates`)

**文件**: `src/templates/templates_list.html`

**功能**:
- ✅ 展示所有转码模板的卡片视图
- ✅ 按编码器类型过滤（FFmpeg/x264/x265/VVenC）
- ✅ 实时加载模板数据（Ajax）
- ✅ 快速操作按钮（查看/编辑/删除）
- ✅ 空状态提示
- ✅ 删除确认弹窗

**特点**:
- 响应式网格布局（1/2/3列）
- 颜色区分编码器类型
- 平滑过渡动画

**截图功能**:
```
┌─────────────────────────────────────────────┐
│ 转码模板管理            [+ 创建新模板]      │
├─────────────────────────────────────────────┤
│ 编码器类型: [全部▼] [FFmpeg] [x264] ...   │
├─────────────────────────────────────────────┤
│ ┌───────────┐  ┌───────────┐  ┌───────────┐│
│ │ H264高质量 │  │ H265压缩  │  │ 快速转码  ││
│ │ [FFmpeg]  │  │ [x265]    │  │ [FFmpeg]  ││
│ │           │  │           │  │           ││
│ │[查看][编辑]│  │[查看][编辑]│  │[查看][编辑]││
│ └───────────┘  └───────────┘  └───────────┘│
└─────────────────────────────────────────────┘
```

### 2. 模板表单页面 (`/templates/new`, `/templates/{id}/edit`)

**文件**: `src/templates/template_form.html`

**功能**:
- ✅ 创建新模板
- ✅ 编辑现有模板
- ✅ 表单验证（必填项、长度限制）
- ✅ 参数示例提示
- ✅ 动态启用/禁用指标选项
- ✅ 自动保存并跳转

**表单字段**:

| 分组 | 字段 | 类型 | 必填 |
|------|------|------|------|
| 基本信息 | 模板名称 | 文本 | ✅ |
| 基本信息 | 描述 | 多行文本 | ❌ |
| 编码器配置 | 编码器类型 | 下拉选择 | ✅ |
| 编码器配置 | 编码参数 | 多行文本 | ✅ |
| 路径配置 | 源视频路径 | 文本 | ✅ |
| 路径配置 | 输出目录 | 文本 | ✅ |
| 路径配置 | 报告目录 | 文本 | ✅ |
| 高级选项 | 启用质量指标 | 复选框 | ❌ |
| 高级选项 | 指标类型 | 多选 | ❌ |
| 高级选项 | 输出格式 | 下拉选择 | ❌ |
| 高级选项 | 并行任务数 | 数字 | ❌ |

**参数示例**:
- FFmpeg (H.264): `-c:v libx264 -preset medium -crf 23`
- FFmpeg (H.265): `-c:v libx265 -preset medium -crf 28`
- x264: `--preset medium --crf 23`
- x265: `--preset medium --crf 28`

### 3. 模板详情页面 (`/templates/{id}`)

**文件**: `src/templates/template_detail.html`

**功能**:
- ✅ 查看模板完整配置
- ✅ 验证路径有效性
- ✅ 执行转码任务
- ✅ 编辑模板
- ✅ 删除模板

**操作按钮**:
- **验证路径**: 检查源路径、输出目录、报告目录是否有效
- **编辑**: 跳转到编辑页面
- **执行转码**: 打开执行对话框

**信息展示**:
- 编码器配置（类型、参数）
- 路径配置（源/输出/报告）
- 质量指标设置
- 高级选项
- 创建/更新时间

## 页面路由

### 前端路由

| 路径 | 页面 | 说明 |
|------|------|------|
| `/templates` | 模板列表 | 展示所有模板 |
| `/templates/new` | 创建模板 | 表单页面（创建模式） |
| `/templates/{id}` | 模板详情 | 查看模板配置 |
| `/templates/{id}/edit` | 编辑模板 | 表单页面（编辑模式） |

### API 端点集成

前端页面调用的 API：

| API | 方法 | 用途 |
|-----|------|------|
| `/api/templates` | GET | 获取模板列表 |
| `/api/templates` | POST | 创建模板 |
| `/api/templates/{id}` | GET | 获取模板详情 |
| `/api/templates/{id}` | PUT | 更新模板 |
| `/api/templates/{id}` | DELETE | 删除模板 |
| `/api/templates/{id}/validate` | GET | 验证路径 |
| `/api/templates/{id}/execute` | POST | 执行转码 |

## 导航菜单更新

**文件**: `src/templates/base.html`

在顶部导航栏添加了"转码模板"链接：

```html
<nav>
  首页 | 任务列表 | 转码模板 | API 文档
</nav>
```

## 首页更新

**文件**: `src/templates/index.html`

添加了快速操作区域：

```
┌─────────────────────────────────────────┐
│ [创建质量分析任务]  [转码模板管理]      │
│ 上传视频，计算指标   配置转码参数       │
└─────────────────────────────────────────┘
```

## JavaScript 功能

### 模板列表页面

**功能实现**:
```javascript
// 加载模板列表
async function loadTemplates(encoderType = '')

// 渲染模板卡片
function renderTemplates()

// 创建单个模板卡片
function createTemplateCard(template)

// 显示/隐藏删除确认框
function showDeleteModal(templateId)
function hideDeleteModal()

// 删除模板
async function deleteTemplate()
```

**事件监听**:
- 编码器类型过滤
- 删除确认/取消
- 模态框外部点击关闭

### 模板表单页面

**功能实现**:
```javascript
// 加载模板数据（编辑模式）
async function loadTemplate()

// 填充表单数据
function populateForm(template)

// 表单提交处理
async function handleSubmit()

// 动态启用/禁用指标类型
enableMetricsCheckboxHandler()
```

**数据验证**:
- 必填字段检查
- 长度限制（名称100字符，描述500字符，参数2000字符）
- 并行任务数范围（1-16）

### 模板详情页面

**功能实现**:
```javascript
// 验证路径
async function validatePaths()

// 显示验证结果
function showValidationResults(result)

// 执行转码
async function executeTemplate()

// 删除模板
async function deleteTemplate()
```

**交互功能**:
- 路径验证结果展示（绿色✓/红色✗）
- 执行转码对话框
- 删除确认对话框

## UI 设计

### 颜色主题

**编码器类型颜色**:
- FFmpeg: 蓝色 (`bg-blue-100 text-blue-800`)
- x264: 绿色 (`bg-green-100 text-green-800`)
- x265: 紫色 (`bg-purple-100 text-purple-800`)
- VVenC: 橙色 (`bg-orange-100 text-orange-800`)

**状态颜色**:
- 成功: 绿色
- 错误: 红色
- 警告: 黄色
- 信息: 蓝色

### 响应式设计

**断点**:
- 移动端 (`sm`): 1列布局
- 平板 (`md`): 2列布局
- 桌面 (`lg`): 3列布局

### 交互反馈

- ✅ 加载状态（旋转图标）
- ✅ 悬停效果（按钮、卡片）
- ✅ 平滑过渡动画
- ✅ 模态框遮罩
- ✅ 表单验证提示

## 用户体验优化

### 1. 空状态处理

当没有模板时，显示友好的空状态提示和创建按钮。

### 2. 加载状态

所有异步操作显示加载指示器，防止重复提交。

### 3. 错误处理

- API 错误显示 alert 提示
- 表单验证错误实时提示
- 网络错误友好提示

### 4. 操作确认

删除操作需要二次确认，防止误操作。

### 5. 参数提示

表单中提供编码参数示例，降低学习成本。

## 浏览器兼容性

**支持的浏览器**:
- Chrome 90+
- Firefox 88+
- Safari 14+
- Edge 90+

**依赖的现代 Web 特性**:
- Fetch API
- Async/Await
- ES6+ 语法
- CSS Grid
- CSS Flexbox
- Tailwind CSS

## 使用流程

### 创建模板

1. 点击"创建新模板"按钮
2. 填写模板名称和描述
3. 选择编码器类型
4. 输入编码参数
5. 配置路径（源/输出/报告）
6. 设置高级选项
7. 点击"创建模板"
8. 跳转到模板详情页

### 编辑模板

1. 在模板列表点击"编辑"
2. 修改表单字段
3. 点击"保存更改"
4. 返回模板详情页

### 执行转码

1. 在模板详情页点击"执行转码"
2. 可选输入源文件列表（每行一个路径）
3. 点击"开始执行"
4. 显示执行结果

### 删除模板

1. 点击"删除"按钮
2. 确认删除操作
3. 返回模板列表

## 文件清单

### 新增文件

- `src/templates/templates_list.html` - 模板列表页面
- `src/templates/template_form.html` - 模板表单页面
- `src/templates/template_detail.html` - 模板详情页面

### 修改文件

- `src/templates/base.html` - 添加导航链接
- `src/templates/index.html` - 添加快速操作
- `src/api/pages.py` - 添加页面路由

## 测试建议

### 功能测试

- [ ] 模板列表加载
- [ ] 创建模板表单验证
- [ ] 创建模板成功
- [ ] 编辑模板加载数据
- [ ] 编辑模板保存
- [ ] 模板详情展示
- [ ] 路径验证功能
- [ ] 执行转码功能
- [ ] 删除模板功能
- [ ] 编码器类型过滤

### UI 测试

- [ ] 响应式布局（移动/平板/桌面）
- [ ] 加载状态显示
- [ ] 模态框交互
- [ ] 表单验证提示
- [ ] 错误消息显示
- [ ] 按钮悬停效果

### 浏览器测试

- [ ] Chrome
- [ ] Firefox
- [ ] Safari
- [ ] Edge

## 后续改进

- [ ] 添加模板搜索功能
- [ ] 支持模板导入/导出
- [ ] 添加模板预览功能
- [ ] 显示执行历史记录
- [ ] WebSocket 实时进度显示
- [ ] 批量操作（批量删除）
- [ ] 模板排序（按名称/时间）
- [ ] 模板标签/分类
- [ ] 更丰富的参数编辑器（语法高亮）

## 已知问题

无

## 性能优化

- ✅ Ajax 异步加载，避免页面刷新
- ✅ 防抖处理（过滤器）
- ✅ 最小化 DOM 操作
- ✅ 使用 CDN 加载外部资源（Tailwind CSS）

---

**完成日期**: 2025-10-27
**作者**: VQMR Team
